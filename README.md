## yesod-react
__yesod with react__

I was interested in merging Yesods fast and safe MPA website generation possibilities with a modern reactive SPA frontend like React. But I did not want to have Yesod as a simple backend just as an alternative to the Node.js http server module. For this I could have used a simpler Haskell web framework like e.g. Servant, Miso, Scotty or Spock. Or I would have used my primitive private standalone Haskell WAI server. No, I was looking for a solution for a real 'hybrid' approach between single-page application (SPA) and multiple-page application (MPA) web frameworks.

So I tried to merge React and Yesod and found a possible solution. In this project I added as an example a normal reactive JavaScript web framework to a yesod project. I have chosen React. It is now possible to hang the React components under each of the Yesods Html page nodes. Yesod uses the so called Shakespearean template languages Hamlet, Cassius, Lucius and Julius. They have their own type safe DOM ID's that are handled by the Haskell web request handlers. These type safe DOM ID', e.g. something like #{toJSON container08}, are not compatible to standard JavaScript and the JavaScript webpack compiler will immediately stop with an error message. 

I added some parser scripts that bypass this problems. With the following environment you are able to simply add any kind of React components (up to complete applications of any size) under each of the DOM nodes of the Html tree of any webpage that is generated by Yesod. 

Preparation
---------------------------
To get ghcup for Mac (if you use another operating system, please look into the Haskell documentation):
```
curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh
```

Start the ghcup graphical user interface:
```
ghcup tui
```

For the Haskell/Yesod backend/frontend you have to install: 
- ghc (tested with version 9.8.2)
- stack (tested with version 2.15.5)

To get React up and running you need to have node.js ond your computer and run npm like e.g.:
```
npm install react react-dom webpack fs babel-loader --save-dev
```
You start then the JavaScript scripts with:  
```
cd react
npm run pre-build
```
Whenever the environment complains it cannot find a library, e.g. @babel/core, just install it:
```
e.g.: npm install @babel/core --save-dev
```

For React you have to install (as with every React/JSX/JavaScript frontend development):
- node.js (tested with version v.20.12.2)
- npm (tested with version 10.5.0)
- react (tested with version 18.3.1)
- react-dom (tested with version 18.3.1)
- webpack (tested with version 5.91.0)
- babel-loader (tested with version 9.1.3)
- @babel/core (tested with version 7.24.5)
- @babel/node" (tested with version 7.23.9)
- @babel/parser (tested with version 7.24.5)
- @babel/plugin-syntax-jsx (tested with version 7.24.1)
- @babel/preset-react (tested with version 7.24.1)
- css-loader (tested with version 7.1.1)
- file-loader (tested with version 6.2.0)
- fs (tested with version 0.0.1-security)
- and some more ...

Development with yesod-react
---------------------------

You develop from folder 'react'.

You have to go to ./react: 
```
cd react
```

Start application:
```
npm run start
```

Build React and Yesod: 
```
npm run build
```

Cleanbuild:
```
npm run cleanbuild
```

Build React only: 
```
npm run pre-build
```

Initiate a normal build and start:
```
npm run coldstart
```

Shorten build time when developing only React:
```
npm run warmstart
```

All scripts in the package.json file:
* "pre-build-1": "node ./parser_jsx.js",
* "pre-build-2": "webpack",
* "pre-build-3": "node ./parser_julius.js",
* "pre-build": "npm run pre-build-1 && npm run pre-build-2 && npm run pre-build-3",
* "build": "npm run pre-build && stack build",
* "cleanbuild": "stack clean && npm run pre-build && stack build",
* "start": "cd ..; yesod devel -p 3000; cd react",
* "coldstart": "npm run build && npm run start;",
* "warmstart": "npm run pre-build && npm run start;",


## Haskell Setup
---------------------------

1. If you haven't already, [install Stack](https://haskell-lang.org/get-started)
	* On POSIX systems, this is usually `curl -sSL https://get.haskellstack.org/ | sh`
2. Install the `yesod` command line tool: `stack install yesod-bin --install-ghc`
3. Build libraries: `stack build`

If you have trouble, refer to the [Yesod Quickstart guide](https://www.yesodweb.com/page/quickstart) for additional detail.

## Development

Start a development server with:

```
stack exec -- yesod devel
```

As your code changes, your site will be automatically recompiled and redeployed to localhost.

## Tests

```
stack test --flag mythirdapp:library-only --flag mythirdapp:dev
```

(Because `yesod devel` passes the `library-only` and `dev` flags, matching those flags means you don't need to recompile between tests and development, and it disables optimization to speed up your test compile times).

## Documentation

* Read the [Yesod Book](https://www.yesodweb.com/book) online for free
* Check [Stackage](http://stackage.org/) for documentation on the packages in your LTS Haskell version, or [search it using Hoogle](https://www.stackage.org/lts/hoogle?q=). Tip: Your LTS version is in your `stack.yaml` file.
* For local documentation, use:
	* `stack haddock --open` to generate Haddock documentation for your dependencies, and open that documentation in a browser
	* `stack hoogle <function, module or type signature>` to generate a Hoogle database and search for your query
* The [Yesod cookbook](https://github.com/yesodweb/yesod-cookbook) has sample code for various needs

## Getting Help

* Ask questions on [Stack Overflow, using the Yesod or Haskell tags](https://stackoverflow.com/questions/tagged/yesod+haskell)
* Ask the [Yesod Google Group](https://groups.google.com/forum/#!forum/yesodweb)
* There are several chatrooms you can ask for help:
	* For IRC, try Freenode#yesod and Freenode#haskell
	* [Functional Programming Slack](https://fpchat-invite.herokuapp.com/), in the #haskell, #haskell-beginners, or #yesod channels.

